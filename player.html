<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  background:transparent;
  font-family:sans-serif;
}

/* OUTER FRAME (gives transparent spacing) */
.frame{
  padding:1px;            /* the magic */
  width:164px;
  height:37px;
  box-sizing:border-box;
}

/* ORIGINAL CONTAINER */
.player{
  position:relative;
  height:35px;
  width:162px;
  background:#000;
  border-radius:10px;
  display:flex;
  align-items:center;
  padding-left:10px;
  padding-right:8px;
}

/* remove blue focus */
button,button:focus{
  outline:none;
  box-shadow:none;
}

/* PLAY */
.play{
  width:0;
  height:0;
  border-top:8px solid transparent;
  border-bottom:8px solid transparent;
  border-left:14px solid #8a8a8a;
  background:none;
  border-right:none;
  cursor:pointer;
  margin-right:10px;
}

/* PAUSE */
.pause{
  width:14px;
  height:16px;
  position:relative;
}
.pause::before,
.pause::after{
  content:"";
  position:absolute;
  width:4px;
  height:16px;
  background:#EDEDED;
}
.pause::after{ right:0; }

/* COUNTER */
.time{
  color:#EDEDED;
  font-size:16px;
  transform-origin:left center;
  transform:scaleY(1.35) scaleX(1.25);
  margin-right:10px;
  position:relative;
  top:-1px;
}

/* SPEAKER */
.speaker{
  width:16px;
  height:16px;
  margin-right:6px;
  position:relative;
  cursor:pointer;
  top:1px;
}

.speaker:before{
  content:"";
  position:absolute;
  width:6px;
  height:8px;
  background:#aaa;
  left:0;
  top:4px;
}

.speaker:after{
  content:"";
  position:absolute;
  width:0;
  height:0;
  border-top:8px solid transparent;
  border-bottom:8px solid transparent;
  border-left:8px solid #aaa;
  left:6px;
}

/* waves */
.waves{
  position:absolute;
  left:16px;
  top:0px;
  color:#aaa;
  font-size:14px;
  line-height:16px;
  transition:color .15s ease;
}
.waves.muted{
  color:#4C4C4C;
}

/* FADER */
input[type=range]{
  -webkit-appearance:none;
  width:55px;
  height:6px;
  margin-left:auto;
  background:linear-gradient(to right,#888 80%,#4C4C4C 80%);
  border-radius:4px;
  cursor:pointer;
  position:relative;
  top:1px;
}

input[type=range]::-webkit-slider-thumb{
  -webkit-appearance:none;
  width:10px;
  height:10px;
  background:#ccc;
  border-radius:50%;
}
</style>
</head>

<body>

<div class="frame">
  <div class="player">
    <button class="play"></button>
    <div class="time">0:00</div>
    <div class="speaker"><div class="waves">)))</div></div>
    <input type="range" min="0" max="1" step="0.01" value="0.8">
    <audio preload="none"></audio>
  </div>
</div>

<script>
/* GOOGLE SITES AUTO HEIGHT */
window.parent.postMessage({type:"resize", height:37}, "*");

/* READ URL */
const params = new URLSearchParams(window.location.search);
const src = params.get("src");

const btn = document.querySelector("button");
const audio = document.querySelector("audio");
const time = document.querySelector(".time");
const speaker = document.querySelector(".speaker");
const waves = document.querySelector(".waves");
const fader = document.querySelector("input");

/* LAZY LOAD WHEN PLAYER ENTERS VIEW */
let loaded = false;

const observer = new IntersectionObserver(entries=>{
  if(entries[0].isIntersecting && !loaded && src){
    audio.src = src + "#t=0,8";   // browser hint
    audio.load();
    loaded = true;
  }
});
observer.observe(document.querySelector(".frame"));

audio.volume = fader.value;

btn.addEventListener("click",()=>{
  if(!audio.src && src){
    audio.src = src;
    audio.load();
  }

  if(audio.paused){
    audio.play();
    btn.className = "pause";
  }else{
    audio.pause();
    btn.className = "play";
  }
});

audio.addEventListener("timeupdate",()=>{
  const m = Math.floor(audio.currentTime/60);
  const s = Math.floor(audio.currentTime%60).toString().padStart(2,'0');
  time.textContent = m+":"+s;
});

fader.addEventListener("input",()=>{
  audio.volume = fader.value;
  const v = fader.value*100;
  fader.style.background = `linear-gradient(to right,#888 ${v}%,#4C4C4C ${v}%)`;
});

speaker.addEventListener("click",()=>{
  audio.muted = !audio.muted;
  waves.classList.toggle("muted", audio.muted);
});
</script>

</body>
</html>
