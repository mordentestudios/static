<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Player</title>

<style>
  /* 1. Eliminamos márgenes y forzamos el tamaño del lienzo */
  html, body {
    margin: 0 !important;
    padding: 0 !important;
    background: transparent;
    overflow: hidden;
    justify-content: center;
    /* Reservamos el espacio para el escalado (164 * 1.2 = 197px) */
    width: 200px; 
/*    height: 48px; */
    height: 100vh;
  }

  /* 2. El frame inicial con tus medidas originales */
  .frame {
    width: 164px;
    height: 37px;
    padding: 1px;
    box-sizing: border-box;
    transform-origin: top center; /* Cambiado a top left para pegarlo al borde azul */
    display: block;
  }

  /* 3. El Player negro */
  .player {
    width: 162px;
    height: 35px;
    background: #000;
    border-radius: 8px;
    display: flex;
    align-items: center;
    padding: 0 8px;
    box-sizing: border-box;
  }

  /* 4. Escalado para Móvil/Táctil */
  @media (pointer: coarse) {
    .frame {
      transform: scale(1.2);
    }
  }

  /* 5. Escalado para contenedores pequeños (Desktop) */
  @media (max-width: 270px) and (pointer: fine) {
    .frame {
      transform: scale(0.8);
    }
  }

/* buttons */
button{
  background:none;
  border:none;
  padding:0;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
}

button:focus{
  outline:none;
  box-shadow:none;
}

/* play */
.play{ margin-right:6px; }
.play svg{
  width:22px;
  height:22px;
  fill:#bfbfbf;
}

/* pause */
.pause rect{ fill:#f2f2f2; }

/* counter */
.time{
  color:#f2f2f2;
  font-size:15px;
  transform:scaleX(0.85);
  transform-origin:left center;
  min-width:32px;
  letter-spacing:1px;
  margin-right:6px;
  position:relative;
  top:-1px;
  left:2px;
}

/* speaker */
.speaker{
  margin-right:1px;
  position:relative;
  top:0px;
  left:2px;
}

.speaker svg{
  width:22px;
  height:22px;
  fill:#bfbfbf;
}

/* WAVES COLOR WHEN MUTED */
.muted .wave{
  stroke:#4C4C4C !important;
}

/* fader */
.volume{
  -webkit-appearance:none;
  appearance:none;
  width:45px;
  height:5px;
  border-radius:3px;
  outline:none;
  position:relative;
  top:0px;
  left:2px;
  background:linear-gradient(to right,#888 80%,#4c4c4c 80%);
}

.volume::-webkit-slider-thumb{
  -webkit-appearance:none;
  width:8px;
  height:8px;
  border-radius:50%;
  background:#ccc;
  cursor:pointer;
}

.volume::-moz-range-thumb{
  width:8px;
  height:8px;
  border-radius:50%;
  background:#ccc;
  cursor:pointer;
}

</style>
</head>

<body>

<div class="frame">
  <div class="player">
    <button class="play"></button>
    <div class="time">0:00</div>
    <button class="speaker"></button>
    <input class="volume" type="range" min="0" max="1" step="0.01" value="0.8">
    <audio preload="none"></audio>
  </div>
</div>

<script>
/* GOOGLE SITES HEIGHT */
window.parent.postMessage({type:"resize", height:37}, "*");

const player = document.querySelector(".player");
const playBtn = player.querySelector(".play");
const speakerBtn = player.querySelector(".speaker");
const time = player.querySelector(".time");
const volumeSlider = player.querySelector(".volume");
const audio = player.querySelector("audio");

const params = new URLSearchParams(window.location.search);
const file = params.get("src");

/* -------- LAZY LOAD -------- */
let previewLoaded = false;

const observer = new IntersectionObserver(entries=>{
  if(entries[0].isIntersecting && !previewLoaded && file){
    audio.src = file + "#t=0,8";
    audio.load();
    previewLoaded = true;
  }
});
observer.observe(document.querySelector(".frame"));

function ensureFull(){
  if(file && audio.src.indexOf("#t=") > -1){
    audio.src = file;
    audio.load();
  }
}

/* icons */
const playIcon = `
<svg viewBox="0 0 24 24">
  <polygon points="6,4 20,12 6,20"></polygon>
</svg>`;

const pauseIcon = `
<svg class="pause" viewBox="0 0 24 24">
  <rect x="6" y="4" width="4" height="16"></rect>
  <rect x="14" y="4" width="4" height="16"></rect>
</svg>`;

const speakerIcon = `
<svg viewBox="0 0 24 24">
  <polygon points="3,9 7,9 12,4 12,20 7,15 3,15"></polygon>
  <path class="wave" d="M14 8 Q19 12 14 16" stroke="#bfbfbf" stroke-width="1.4" fill="none"/>
  <path class="wave" d="M16 6 Q22 12 16 18" stroke="#bfbfbf" stroke-width="1.4" fill="none"/>
</svg>`;

playBtn.innerHTML = playIcon;
speakerBtn.innerHTML = speakerIcon;

/* play */
playBtn.onclick = ()=>{
  if(!audio.src && file){
    audio.src = file;
    audio.load();
  }
  ensureFull();

  if(audio.paused){
    document.querySelectorAll("audio").forEach(a=>{ if(a!==audio) a.pause(); });
    document.querySelectorAll(".play").forEach(b=>b.innerHTML=playIcon);
    audio.play();
    playBtn.innerHTML = pauseIcon;
  }else{
    audio.pause();
    playBtn.innerHTML = playIcon;
  }
};

/* time */
audio.ontimeupdate = ()=>{
  const m = Math.floor(audio.currentTime/60);
  const s = Math.floor(audio.currentTime%60).toString().padStart(2,"0");
  time.textContent = `${m}:${s}`;
};

/* volume */
function updateVolumeTrack(v){
  const p = v*100;
  volumeSlider.style.background =
  `linear-gradient(to right,#888 ${p}%,#4c4c4c ${p}%)`;
}

volumeSlider.oninput = ()=>{
  audio.volume = volumeSlider.value;
  updateVolumeTrack(volumeSlider.value);
};

speakerBtn.onclick = ()=>{
  audio.muted = !audio.muted;
  speakerBtn.classList.toggle("muted");
};

audio.volume = 0.8;
updateVolumeTrack(0.8);
</script>

</body>
</html>
