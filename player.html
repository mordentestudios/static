<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Player</title>

<style>
body{
  margin:0;
  background:transparent;
  font-family:sans-serif;
}

.player{
  width:162px;
  height:35px;
  background:#000;
  border-radius:8px;
  display:flex;
  align-items:center;
  padding:0 8px;
  box-sizing:border-box;
}

/* buttons */
button{
  background:none;
  border:none;
  padding:0;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
}

button:focus{
  outline:none;
  box-shadow:none;
}

/* play */
.play{
  margin-right:6px;
}

.play svg{
  width:22px;
  height:22px;
  fill:#bfbfbf;
}

/* pause */
.pause rect{
  fill:#f2f2f2;
}

/* counter */
.time{
  color:#f2f2f2;
  font-size:15px;
  transform:scaleX(0.85);
  transform-origin:left center;
  min-width:32px;
  letter-spacing:1px;

  margin-right:6px;

  position:relative;
  top:-2px;      /* UP */
  left:2px;      /* move right together with speaker */
}

/* speaker */
.speaker{
  margin-right:1px;  /* bring closer to fader */
  position:relative;
  top:0px;       /* DOWN compared to before */
  left:2px;      /* same right shift as counter */
}

.speaker svg{
  width:22px;
  height:22px;
  fill:#bfbfbf;
}

/* waves disappear on mute */
.muted .wave{
  display:none;
}

/* fader */
.volume{
  -webkit-appearance:none;
  appearance:none;
  width:45px;
  height:5px;
  border-radius:3px;
  outline:none;

  position:relative;
  top:0px;       /* DOWN */
  left:2px;      /* tiny push right */
}

/* gradient */
.volume{
  background:linear-gradient(to right,#888 80%,#4c4c4c 80%);
}

.volume::-webkit-slider-thumb{
  -webkit-appearance:none;
  appearance:none;
  width:8px;
  height:8px;
  border-radius:50%;
  background:#ccc;
  cursor:pointer;
}

.volume::-moz-range-thumb{
  width:8px;
  height:8px;
  border-radius:50%;
  background:#ccc;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="player">
  <button class="play"></button>
  <div class="time">0:00</div>
  <button class="speaker"></button>
  <input class="volume" type="range" min="0" max="1" step="0.01" value="0.8">
  <audio></audio>
</div>

<script>
const players = document.querySelectorAll(".player");

players.forEach(player=>{
  const playBtn = player.querySelector(".play");
  const speakerBtn = player.querySelector(".speaker");
  const time = player.querySelector(".time");
  const volumeSlider = player.querySelector(".volume");
  const audio = player.querySelector("audio");

  const params = new URLSearchParams(window.location.search);
  const file = params.get("src");
  if(file){ audio.src = file; }

  function formatTime(sec){
    const m = Math.floor(sec/60);
    const s = Math.floor(sec%60).toString().padStart(2,"0");
    return `${m}:${s}`;
  }

  function stopOthers(){
    document.querySelectorAll("audio").forEach(a=>{
      if(a!==audio){ a.pause(); }
    });
    document.querySelectorAll(".play").forEach(btn=>{
      btn.innerHTML = playIcon;
    });
  }

  const playIcon = `
  <svg viewBox="0 0 24 24">
    <polygon points="6,4 20,12 6,20"></polygon>
  </svg>`;

  const pauseIcon = `
  <svg class="pause" viewBox="0 0 24 24">
    <rect x="6" y="4" width="4" height="16"></rect>
    <rect x="14" y="4" width="4" height="16"></rect>
  </svg>`;

  const speakerIcon = `
  <svg viewBox="0 0 24 24">
    <polygon points="3,9 7,9 12,4 12,20 7,15 3,15"></polygon>
    <path class="wave" d="M14 8 Q19 12 14 16" stroke="#bfbfbf" stroke-width="1.4" fill="none"/>
    <path class="wave" d="M16 6 Q22 12 16 18" stroke="#bfbfbf" stroke-width="1.4" fill="none"/>
  </svg>`;

  playBtn.innerHTML = playIcon;
  speakerBtn.innerHTML = speakerIcon;

  playBtn.onclick = ()=>{
    if(audio.paused){
      stopOthers();
      audio.play();
      playBtn.innerHTML = pauseIcon;
    } else {
      audio.pause();
      playBtn.innerHTML = playIcon;
    }
  };

  audio.ontimeupdate = ()=>{
    time.textContent = formatTime(audio.currentTime);
  };

  function updateVolumeTrack(v){
    const percent = v*100;
    volumeSlider.style.background =
      `linear-gradient(to right,#888 ${percent}%,#4c4c4c ${percent}%)`;
  }

  volumeSlider.oninput = ()=>{
    audio.volume = volumeSlider.value;
    updateVolumeTrack(volumeSlider.value);
  };

  speakerBtn.onclick = ()=>{
    audio.muted = !audio.muted;
    speakerBtn.classList.toggle("muted");
  };

  audio.volume = 0.8;
  updateVolumeTrack(0.8);
});
</script>

</body>
</html>
